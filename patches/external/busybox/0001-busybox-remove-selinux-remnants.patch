From 250566782f49615c6a8010ac70afb93f69ed23b2 Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Wed, 1 Nov 2017 21:44:42 +0300
Subject: [PATCH] busybox: remove selinux remnants

---
 Android.mk              | 2 +-
 Makefile.flags          | 3 +--
 busybox-full.config     | 2 +-
 busybox-full.sources    | 5 -----
 busybox-minimal.config  | 2 +-
 busybox-minimal.sources | 5 -----
 6 files changed, 4 insertions(+), 15 deletions(-)

diff --git a/Android.mk b/Android.mk
index b657f8d..47a17b5 100644
--- a/Android.mk
+++ b/Android.mk
@@ -93,7 +93,7 @@ BUSYBOX_C_INCLUDES = \
 	$(BB_PATH)/android/librpc
 
 BUSYBOX_CFLAGS = \
-	-Werror=implicit -Wno-clobbered \
+	-Wno-clobbered \
 	-DNDEBUG \
 	-DANDROID \
 	-fno-strict-aliasing \
diff --git a/Makefile.flags b/Makefile.flags
index 640eeec..7240bbd 100644
--- a/Makefile.flags
+++ b/Makefile.flags
@@ -25,14 +25,13 @@ CFLAGS += $(call cc-option,-Wstrict-prototypes,)
 CFLAGS += $(call cc-option,-Wunused -Wunused-parameter,)
 CFLAGS += $(call cc-option,-Wunused-function -Wunused-value,)
 CFLAGS += $(call cc-option,-Wmissing-prototypes -Wmissing-declarations,)
-CFLAGS += $(call cc-option,-Wno-format-security,)
+#CFLAGS += $(call cc-option,-Wno-format-security,)
 # warn about C99 declaration after statement
 CFLAGS += $(call cc-option,-Wdeclaration-after-statement,)
 # If you want to add more -Wsomething above, make sure that it is
 # still possible to build bbox without warnings.
 
 ifeq ($(CONFIG_WERROR),y)
-CFLAGS += $(call cc-option,-Werror,)
 ## TODO:
 ## gcc version 4.4.0 20090506 (Red Hat 4.4.0-4) (GCC) is a PITA:
 ## const char *ptr; ... off_t v = *(off_t*)ptr; -> BOOM
diff --git a/busybox-full.config b/busybox-full.config
index b11099b..bc7ea73 100644
--- a/busybox-full.config
+++ b/busybox-full.config
@@ -46,7 +46,7 @@ CONFIG_PID_FILE_PATH=""
 CONFIG_FEATURE_SUID=y
 # CONFIG_FEATURE_SUID_CONFIG is not set
 # CONFIG_FEATURE_SUID_CONFIG_QUIET is not set
-CONFIG_SELINUX=y
+CONFIG_SELINUX=n
 # CONFIG_FEATURE_PREFER_APPLETS is not set
 CONFIG_BUSYBOX_EXEC_PATH="/proc/self/exe"
 CONFIG_FEATURE_SYSLOG=y
diff --git a/busybox-full.sources b/busybox-full.sources
index bd5b59c..4a0ddf1 100644
--- a/busybox-full.sources
+++ b/busybox-full.sources
@@ -69,11 +69,6 @@ procps/lsof.c procps/nmeter.c procps/pstree.c procps/pwdx.c procps/smemcap.c
 
 shell/ash.c shell/ash_ptr_hack.c shell/math.c shell/random.c shell/shell_common.c
 
-libbb/selinux_common.c android/selinux/matchpathcon.c android/selinux/stubs.c
-selinux/chcon.c selinux/selinuxenabled.c
-selinux/getenforce.c selinux/sestatus.c selinux/setsebool.c
-selinux/getsebool.c selinux/runcon.c selinux/setenforce.c selinux/setfiles.c selinux/matchpathcon.c
-
 util-linux/blkid.c util-linux/blockdev.c util-linux/dmesg.c util-linux/fdisk.c util-linux/findfs.c util-linux/flock.c
 util-linux/freeramdisk.c util-linux/fstrim.c util-linux/getopt.c
 util-linux/hexdump.c util-linux/hwclock.c util-linux/losetup.c util-linux/lspci.c util-linux/lsusb.c
diff --git a/busybox-minimal.config b/busybox-minimal.config
index eeed3bb..920686c 100644
--- a/busybox-minimal.config
+++ b/busybox-minimal.config
@@ -46,7 +46,7 @@ CONFIG_PID_FILE_PATH=""
 CONFIG_FEATURE_SUID=y
 # CONFIG_FEATURE_SUID_CONFIG is not set
 # CONFIG_FEATURE_SUID_CONFIG_QUIET is not set
-CONFIG_SELINUX=y
+CONFIG_SELINUX=n
 # CONFIG_FEATURE_PREFER_APPLETS is not set
 CONFIG_BUSYBOX_EXEC_PATH="/proc/self/exe"
 # CONFIG_FEATURE_SYSLOG is not set
diff --git a/busybox-minimal.sources b/busybox-minimal.sources
index 84950cf..b5abaf2 100644
--- a/busybox-minimal.sources
+++ b/busybox-minimal.sources
@@ -44,11 +44,6 @@ procps/renice.c procps/sysctl.c procps/top.c procps/uptime.c procps/watch.c
 
 shell/ash.c shell/ash_ptr_hack.c shell/math.c shell/random.c shell/shell_common.c
 
-android/selinux/matchpathcon.c android/selinux/stubs.c
-libbb/selinux_common.c selinux/chcon.c selinux/selinuxenabled.c
-selinux/getenforce.c selinux/sestatus.c selinux/setsebool.c
-selinux/getsebool.c selinux/setenforce.c selinux/setfiles.c selinux/matchpathcon.c
-
 util-linux/blkid.c util-linux/blockdev.c util-linux/dmesg.c util-linux/fdisk.c util-linux/freeramdisk.c util-linux/fstrim.c util-linux/getopt.c
 util-linux/hexdump.c util-linux/losetup.c util-linux/lspci.c util-linux/lsusb.c util-linux/mkfs_ext2.c util-linux/mkfs_vfat.c util-linux/mkswap.c
 util-linux/more.c util-linux/mount.c util-linux/rdev.c util-linux/rev.c util-linux/swaponoff.c util-linux/switch_root.c util-linux/umount.c
-- 
2.7.4

