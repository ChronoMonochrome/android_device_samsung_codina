Subject: [PATCH] FATAL EXCEPTION IN SYSTEM PROCESS: android.ui

when 3rd party app put an extra with a bad serial object
to start a service or sendbroadcast to system_server.
It will cause system_server crash because of
classNotFoundException.

A test demo apk will cause system_server crash.
It really affact the system stability

Intent intent = new Intent(Intent.ACTION_CLOSE_SYSTEM_DIALOGS);
intent.putExtra(Intent.EXTRA_REFERRER, new serial()
/*a Serializable class object*/);
sendBroadcast(intent);

Test: use the test apk attached in the issue below, system_server will
crash every time. And it'll be OK with this CL.

diff --git a/core/java/android/os/BaseBundle.java b/core/java/android/os/BaseBundle.java
index 8d85880..6187089 100644
--- a/core/java/android/os/BaseBundle.java
+++ b/core/java/android/os/BaseBundle.java
@@ -278,6 +278,13 @@
             } else {
                 throw e;
             }
+        } catch (RuntimeException e) {
+            if (sShouldDefuse && (e.getCause() instanceof ClassNotFoundException)) {
+                Log.w(TAG, "Failed to parse Bundle, but defusing quietly", e);
+                map.erase();
+            } else {
+                throw e;
+            }
         } finally {
             mMap = map;
             if (recycleParcel) {
