From e47b0dbf3d92e31effd7e8c20f5bf470f3c4edbc Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Thu, 4 May 2017 10:26:25 +0300
Subject: [PATCH 15/25] system-core_WW06-STE-u8500-hardware.patch

Change-Id: I6222c1c243b5c0388c309d0654f8c6272ea3f26a
---
 libutils/String8.cpp | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/libutils/String8.cpp b/libutils/String8.cpp
index 755e0d1..153b9d7 100644
--- a/libutils/String8.cpp
+++ b/libutils/String8.cpp
@@ -25,6 +25,7 @@
 #include <utils/String16.h>
 #include <utils/threads.h>
 
+#include <cutils/compiler.h>
 #include <ctype.h>
 
 #include "SharedBuffer.h"
@@ -171,9 +172,14 @@ String8::String8(const String8& o)
 }
 
 String8::String8(const char* o)
-    : mString(allocFromUTF8(o, strlen(o)))
+    : mString(0)
 {
-    if (mString == NULL) {
+    if (CC_LIKELY(o != NULL)) {
+        mString = allocFromUTF8(o, strlen(o));
+        if (mString == NULL) {
+            mString = getEmptyString();
+        }
+    } else {
         mString = getEmptyString();
     }
 }
-- 
2.5.0

