From 2776c0d02263c08e1194116b74de7f7e0a3334e5 Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Fri, 9 Sep 2016 02:01:18 +0700
Subject: [PATCH 2/2] Revert "keystore: Add SOTER support in keystore"

This reverts commit b926925d638eefb2345256361bdae7b4bbead4dc.

Change-Id: Ie0eb4c83e9a9e70127bd7200f4db17c7f264ee77
---
 keystore/keystore.cpp | 25 -------------------------
 1 file changed, 25 deletions(-)

diff --git a/keystore/keystore.cpp b/keystore/keystore.cpp
index e9fa408..8f276f5 100644
--- a/keystore/keystore.cpp
+++ b/keystore/keystore.cpp
@@ -2433,31 +2433,6 @@ public:
         const keymaster1_device_t* device = mKeyStore->getDevice();
         const keymaster1_device_t* fallback = mKeyStore->getFallbackDevice();
         std::vector<keymaster_key_param_t> opParams(params.params);
-
-        for (auto param: params.params)
-        {
-            switch (param.tag) {
-                case KM_TAG_SOTER_AUTO_SIGNED_COMMON_KEY_WHEN_GET_PUBLIC_KEY:
-                {
-                    uid_t callingUid = IPCThreadState::self()->getCallingUid();
-                    Blob keyBlob;
-                    String8 name8(reinterpret_cast<const char*>(param.blob.data));
-                    ResponseCode responseCode = mKeyStore->getKeyForName(&keyBlob,
-                            name8, callingUid, TYPE_KEYMASTER_10);
-                    if (responseCode != ::NO_ERROR) {
-                        return responseCode;
-                    }
-                    opParams.push_back(keymaster_param_blob(
-                            KM_TAG_SOTER_AUTO_SIGNED_COMMON_KEY_WHEN_GET_PUBLIC_KEY_BLOB,
-                            keyBlob.getValue(),
-                            keyBlob.getLength()));
-                    break;
-                }
-                default:
-                    break;
-            }
-        }
-
         const keymaster_key_param_set_t inParams = {opParams.data(), opParams.size()};
         if (device == NULL) {
             return ::SYSTEM_ERROR;
-- 
2.5.0

