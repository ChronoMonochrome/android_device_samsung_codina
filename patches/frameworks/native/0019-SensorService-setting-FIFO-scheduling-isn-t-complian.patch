From 1a60196d67f20bda6b80775b52fde83af2f3facb Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Thu, 29 Dec 2016 03:37:09 +0700
Subject: [PATCH 19/26] SensorService: setting FIFO scheduling isn't compliant
 with our sensors HAL

credits to Sergeyl@4pda.ru
---
 services/sensorservice/Android.mk        | 2 +-
 services/sensorservice/SensorService.cpp | 2 ++
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/services/sensorservice/Android.mk b/services/sensorservice/Android.mk
index 7b10319..889e2cd 100644
--- a/services/sensorservice/Android.mk
+++ b/services/sensorservice/Android.mk
@@ -24,7 +24,7 @@ LOCAL_CFLAGS:= -DLOG_TAG=\"SensorService\"
 
 LOCAL_CFLAGS += -Wall -Werror -Wextra
 
-LOCAL_CFLAGS += -fvisibility=hidden
+LOCAL_CFLAGS += -fvisibility=hidden -DSENSORS_DONT_SUPPORT_FIFO
 
 LOCAL_SHARED_LIBRARIES := \
     libcutils \
diff --git a/services/sensorservice/SensorService.cpp b/services/sensorservice/SensorService.cpp
index dbd0624..87af47f 100644
--- a/services/sensorservice/SensorService.cpp
+++ b/services/sensorservice/SensorService.cpp
@@ -273,8 +273,10 @@ void SensorService::onFirstRef() {
             mAckReceiver->run("SensorEventAckReceiver", PRIORITY_URGENT_DISPLAY);
             run("SensorService", PRIORITY_URGENT_DISPLAY);
 
+#ifndef SENSORS_DONT_SUPPORT_FIFO
             // priority can only be changed after run
             enableSchedFifoMode();
+#endif
         }
     }
 }
-- 
2.9.3

