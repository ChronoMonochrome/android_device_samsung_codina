From cc9a03aaf4001cd2098f156fc51caf48120c0ac9 Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Mon, 5 Dec 2016 01:17:29 +0700
Subject: [PATCH 13/26] libgui: disable mLastDequeueDuration calculation

thanks to SergeyL@4pda.ru for idea
---
 libs/gui/Surface.cpp | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/libs/gui/Surface.cpp b/libs/gui/Surface.cpp
index 0bb142b..1081df1 100644
--- a/libs/gui/Surface.cpp
+++ b/libs/gui/Surface.cpp
@@ -294,10 +294,14 @@ int Surface::dequeueBuffer(android_native_buffer_t** buffer, int* fenceFd) {
 
     int buf = -1;
     sp<Fence> fence;
+#ifndef LAST_DEQUEUE_DURATION_OFF
     nsecs_t now = systemTime();
+#endif
     status_t result = mGraphicBufferProducer->dequeueBuffer(&buf, &fence,
             reqWidth, reqHeight, reqFormat, reqUsage);
+#ifndef LAST_DEQUEUE_DURATION_OFF
     mLastDequeueDuration = systemTime() - now;
+#endif
 
     if (result < 0) {
         ALOGV("dequeueBuffer: IGraphicBufferProducer::dequeueBuffer"
@@ -500,9 +504,13 @@ int Surface::queueBuffer(android_native_buffer_t* buffer, int fenceFd) {
         input.setSurfaceDamage(flippedRegion);
     }
 
+#ifndef LAST_DEQUEUE_DURATION_OFF
     nsecs_t now = systemTime();
+#endif
     status_t err = mGraphicBufferProducer->queueBuffer(i, input, &output);
+#ifndef LAST_DEQUEUE_DURATION_OFF
     mLastQueueDuration = systemTime() - now;
+#endif
     if (err != OK)  {
         ALOGE("queueBuffer: error queuing buffer to SurfaceTexture, %d", err);
     }
-- 
2.9.3

