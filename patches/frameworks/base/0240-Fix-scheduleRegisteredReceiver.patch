From b56a2515c51d5ed0b5d9e8216e6249be0a9fc20b Mon Sep 17 00:00:00 2001
From: riddle_hsu <riddle_hsu@htc.com>
Date: Sat, 24 Oct 2015 01:49:50 +0800
Subject: [PATCH 240/296] Fix scheduleRegisteredReceiver

---
 core/java/android/app/ActivityThread.java | 14 +++++++++++---
 1 file changed, 11 insertions(+), 3 deletions(-)

diff --git a/core/java/android/app/ActivityThread.java b/core/java/android/app/ActivityThread.java
index 50e2edb3d2f..fa389990225 100644
--- a/core/java/android/app/ActivityThread.java
+++ b/core/java/android/app/ActivityThread.java
@@ -1021,16 +1021,24 @@ public final class ActivityThread {
         public void scheduleRegisteredReceiver(IIntentReceiver receiver, Intent intent,
                 int resultCode, String dataStr, Bundle extras, boolean ordered,
                 boolean sticky, int sendingUser, int processState) throws RemoteException {
+            RemoteException remoteException = null;
             if (!Binder.isProxy(receiver)) {
                 updateProcessState(processState, false);
-                receiver.performReceive(intent, resultCode, dataStr, extras, ordered,
-                        sticky, sendingUser);
-                return;
+                try {
+                    receiver.performReceive(intent, resultCode, dataStr, extras, ordered,
+                            sticky, sendingUser);
+                    return;
+                } catch (RemoteException e) {
+                    remoteException = e;
+                }
             }
             if (ordered) {
                 Slog.w(TAG, receiver + " is no longer alive");
                 ActivityManagerNative.getDefault().finishReceiver(receiver.asBinder(),
                         resultCode, dataStr, extras, true, intent.getFlags());
+                if (remoteException != null) {
+                    throw remoteException;
+                }
             }
         }
 
-- 
2.11.0

