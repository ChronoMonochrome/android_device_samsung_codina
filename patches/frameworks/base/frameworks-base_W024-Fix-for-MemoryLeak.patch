From a0943bd277ed9b5ecaf1c7c1ace7590b1b6da37d Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Mon, 20 Aug 2018 22:57:43 +0300
Subject: [PATCH] Fix for MemoryLeak in InputMethodService

Problem: when onConfigrationChanged is called many times,
mInsetsComputer is added many times to the list.
Solution: check before if specific listener is already
in the arraylist.

diff --git a/core/java/android/view/ViewTreeObserver.java b/core/java/android/view/ViewTreeObserver.java
index a9444b4..b0dfd8a 100644
--- a/core/java/android/view/ViewTreeObserver.java
+++ b/core/java/android/view/ViewTreeObserver.java
@@ -1178,7 +1178,9 @@ int size() {
         }
 
         void add(T item) {
-            getArray().add(item);
+            if (!getArray().contains(item)) {
+                getArray().add(item);
+            }
         }
 
         void addAll(CopyOnWriteArray<T> array) {
