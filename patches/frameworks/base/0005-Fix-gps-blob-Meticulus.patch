From a20341d3a3302f021afb6f60be075129b73b5608 Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Fri, 17 Jul 2015 23:46:34 +0300
Subject: [PATCH 5/6] Fix gps blob [Meticulus]

Change-Id: Ia408c5c1dcbf2e581de9b76bfe7dbb9fd70c35d3
---
 .../java/com/android/server/location/GpsLocationProvider.java    | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/services/java/com/android/server/location/GpsLocationProvider.java b/services/java/com/android/server/location/GpsLocationProvider.java
index 138cf61..4f95983 100644
--- a/services/java/com/android/server/location/GpsLocationProvider.java
+++ b/services/java/com/android/server/location/GpsLocationProvider.java
@@ -593,7 +593,14 @@ public class GpsLocationProvider implements LocationProviderInterface {
     }
 
     private void handleUpdateNetworkState(int state, NetworkInfo info) {
-        mNetworkAvailable = (state == LocationProvider.AVAILABLE);
+
+	/*
+	 * Meticulus:
+	 * If GPS is not on then bail out of here!
+         */
+        LocationManager manager = (LocationManager) mContext.getSystemService( Context.LOCATION_SERVICE );
+        if ( !manager.isProviderEnabled( LocationManager.GPS_PROVIDER ) )
+            return;
 
         if (DEBUG) {
             Log.d(TAG, "updateNetworkState " + (mNetworkAvailable ? "available" : "unavailable")
-- 
1.9.1

