From 376ccf10badbd10d5aa39224a072584d4052e14b Mon Sep 17 00:00:00 2001
From: Lorenzo Colitti <lorenzo@google.com>
Date: Tue, 8 Sep 2015 16:49:43 +0900
Subject: [PATCH 224/296] Fix PacketKeepalive.stop() crash

If the keepalive stop() function is called when the mSlot number is
not yet setup, the conversion from null to integer will crash.
This patch fixes it by adding the error checking.
---
 core/java/android/net/ConnectivityManager.java | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/core/java/android/net/ConnectivityManager.java b/core/java/android/net/ConnectivityManager.java
index d7ecc81ffdb..73496e83225 100644
--- a/core/java/android/net/ConnectivityManager.java
+++ b/core/java/android/net/ConnectivityManager.java
@@ -1581,6 +1581,9 @@ public class ConnectivityManager {
         }
 
         public void stop() {
+            if (mSlot == null) {
+                return;
+            }
             try {
                 mService.stopKeepalive(mNetwork, mSlot);
             } catch (RemoteException e) {
-- 
2.11.0

