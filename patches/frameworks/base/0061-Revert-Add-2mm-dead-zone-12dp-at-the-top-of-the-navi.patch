From 438811424f4e6eb53ebb3458b90bb9ea58f7a48b Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Mon, 25 Jan 2016 03:44:51 +0700
Subject: [PATCH 61/64] Revert "Add 2mm dead zone (12dp) at the top of the
 navigation bar."

This reverts commit 41006aaf3494a46731868dcb9347caf05f8804a4.

Change-Id: Id5b99f05985b57d5ba2c13935b188391ac08615e
---
 packages/SystemUI/res/layout/navigation_bar.xml    | 235 +++++++++------------
 .../statusbar/phone/NavigationBarView.java         |  13 +-
 2 files changed, 108 insertions(+), 140 deletions(-)

diff --git a/packages/SystemUI/res/layout/navigation_bar.xml b/packages/SystemUI/res/layout/navigation_bar.xml
index bbda9ef..bc2f7ee 100644
--- a/packages/SystemUI/res/layout/navigation_bar.xml
+++ b/packages/SystemUI/res/layout/navigation_bar.xml
@@ -4,178 +4,149 @@
 **
 ** Copyright 2011, The Android Open Source Project
 **
-** Licensed under the Apache License, Version 2.0 (the "License");
-** you may not use this file except in compliance with the License.
-** You may obtain a copy of the License at
+** Licensed under the Apache License, Version 2.0 (the "License"); 
+** you may not use this file except in compliance with the License. 
+** You may obtain a copy of the License at 
 **
-**     http://www.apache.org/licenses/LICENSE-2.0
+**     http://www.apache.org/licenses/LICENSE-2.0 
 **
-** Unless required by applicable law or agreed to in writing, software
-** distributed under the License is distributed on an "AS IS" BASIS,
-** WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-** See the License for the specific language governing permissions and
+** Unless required by applicable law or agreed to in writing, software 
+** distributed under the License is distributed on an "AS IS" BASIS, 
+** WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
+** See the License for the specific language governing permissions and 
 ** limitations under the License.
 */
 -->
 
 <com.android.systemui.statusbar.phone.NavigationBarView
-        xmlns:android="http://schemas.android.com/apk/res/android"
-        xmlns:systemui="http://schemas.android.com/apk/res/com.android.systemui"
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:systemui="http://schemas.android.com/apk/res/com.android.systemui"
+    android:layout_height="match_parent"
+    android:layout_width="match_parent"
+    >
+
+    <FrameLayout
+        android:id="@+id/background"
         android:layout_height="match_parent"
         android:layout_width="match_parent"
-        android:background="@drawable/system_bar_background"
+        android:background="#FF000000"
         >
 
-    <FrameLayout
-            android:id="@+id/rot0"
+        <LinearLayout android:id="@+id/rot0"
             android:layout_height="match_parent"
             android:layout_width="match_parent"
+            android:orientation="horizontal"
             >
 
-        <LinearLayout
+            <!-- navigation controls -->
+            <View
+                android:layout_width="32dp"
                 android:layout_height="match_parent"
-                android:layout_width="match_parent"
-                android:orientation="horizontal"
-                android:clipChildren="false"
-                android:clipToPadding="false"
-                android:id="@+id/nav_buttons"
-                android:animateLayoutChanges="true"
-                >
-
-
-        </LinearLayout>
-
-        <!-- lights out layout to match exactly -->
-        <LinearLayout
+                android:layout_weight="0"
+                />
+            <com.android.systemui.statusbar.policy.KeyButtonView android:id="@+id/back"
+                android:layout_width="54dp"
                 android:layout_height="match_parent"
+                android:src="@drawable/ic_sysbar_back_default"
+                systemui:keyCode="4"
+                android:layout_weight="0"
+                />
+            <View 
                 android:layout_width="match_parent"
-                android:orientation="horizontal"
-                android:id="@+id/lights_out"
-                android:visibility="gone"
-                >
-
-        </LinearLayout>
-
-        <FrameLayout
+                android:layout_height="match_parent"
+                android:layout_weight="1"
+                />
+            <com.android.systemui.statusbar.policy.KeyButtonView android:id="@+id/home"
+                android:layout_width="54dp"
+                android:layout_height="match_parent"
+                android:src="@drawable/ic_sysbar_home_default"
+                systemui:keyCode="3"
+                android:layout_weight="0"
+                />
+            <View 
                 android:layout_width="match_parent"
-                android:layout_height="match_parent">
-
-            <com.android.systemui.statusbar.policy.KeyButtonView
-                android:layout_width="80dp"
-                android:id="@+id/show_notifs"
                 android:layout_height="match_parent"
-                android:layout_gravity="center_vertical|left"
-                android:scaleType="center"
-                android:visibility="gone"/>
-
-            <com.android.systemui.statusbar.policy.KeyButtonView
-                android:layout_width="80dp"
-                android:id="@+id/search_light"
+                android:layout_weight="1"
+                />
+            <ImageView android:id="@+id/recent_apps"
+                android:layout_width="54dp"
                 android:layout_height="match_parent"
-                android:layout_gravity="center"
-                android:src="@drawable/search_light"
-                android:scaleType="center"
-                android:visibility="gone"
-                android:contentDescription="@string/accessibility_search_light"
+                android:src="@drawable/ic_sysbar_recent_default"
+                android:layout_weight="0"
                 />
-
-            <com.android.systemui.statusbar.policy.KeyButtonView
-                    android:id="@+id/camera_button"
-                    android:layout_height="match_parent"
-                    android:layout_width="80dp"
-                    android:layout_gravity="center_vertical|right"
-                    android:src="@drawable/ic_sysbar_camera"
-                    android:scaleType="center"
-                    android:visibility="gone"
-                    android:contentDescription="@string/accessibility_camera_button"
-                    />
-        </FrameLayout>
-
-        <com.android.systemui.statusbar.policy.DeadZone
-                android:id="@+id/deadzone"
+            <com.android.systemui.statusbar.policy.KeyButtonView android:id="@+id/menu"
+                android:layout_width="32dp"
                 android:layout_height="match_parent"
-                android:layout_width="match_parent"
-                systemui:minSize="@dimen/navigation_bar_deadzone_size"
-                systemui:maxSize="@dimen/navigation_bar_deadzone_size_max"
-                systemui:holdTime="@integer/navigation_bar_deadzone_hold"
-                systemui:decayTime="@integer/navigation_bar_deadzone_decay"
-                systemui:orientation="horizontal"
-                android:layout_gravity="top"
+                android:src="@drawable/ic_sysbar_menu_default"
+                systemui:keyCode="82"
+                android:layout_weight="0"
+                android:visibility="invisible"
                 />
-    </FrameLayout>
+        </LinearLayout>
 
-    <FrameLayout
-            android:id="@+id/rot90"
+        <LinearLayout android:id="@+id/rot90"
             android:layout_height="match_parent"
             android:layout_width="match_parent"
+            android:orientation="vertical"
             android:visibility="gone"
-            android:paddingTop="0dp"
+            android:paddingTop="24dp"
             >
-
-        <LinearLayout
-                android:layout_height="match_parent"
+            
+            <!-- navigation controls -->
+            <com.android.systemui.statusbar.policy.KeyButtonView android:id="@+id/menu"
+                android:layout_height="32dp"
                 android:layout_width="match_parent"
-                android:orientation="vertical"
-                android:clipChildren="false"
-                android:clipToPadding="false"
-                android:id="@+id/nav_buttons"
-                android:animateLayoutChanges="true"
-                >
-
-
-        </LinearLayout>
-
-        <!-- lights out layout to match exactly -->
-        <LinearLayout
-                android:layout_height="match_parent"
+                android:src="@drawable/ic_sysbar_menu_default_land"
+                systemui:keyCode="82"
+                android:layout_weight="0"
+                android:visibility="invisible"
+                />
+            <ImageView android:id="@+id/recent_apps"
+                android:layout_height="54dp"
                 android:layout_width="match_parent"
-                android:orientation="vertical"
-                android:id="@+id/lights_out"
-                android:visibility="gone"
-                >
-
-        </LinearLayout>
-
-        <com.android.systemui.statusbar.policy.KeyButtonView
-                android:layout_width="80dp"
-                android:id="@+id/show_notifs"
+                android:src="@drawable/ic_sysbar_recent_default_land"
+                android:layout_weight="0"
+                />
+            <View 
                 android:layout_height="match_parent"
-                android:layout_gravity="center_vertical|left"
-                android:scaleType="center"
-                android:visibility="gone"/>
-
-        <com.android.systemui.statusbar.policy.KeyButtonView
-                android:id="@+id/search_light"
-                android:layout_height="80dp"
                 android:layout_width="match_parent"
-                android:layout_gravity="center_vertical"
-                android:src="@drawable/search_light_land"
-                android:scaleType="center"
-                android:visibility="gone"
-                android:contentDescription="@string/accessibility_search_light"
+                android:layout_weight="1"
                 />
-
-        <!-- No camera button in landscape mode -->
-
-        <com.android.systemui.statusbar.policy.DeadZone
-                android:id="@+id/deadzone"
+            <com.android.systemui.statusbar.policy.KeyButtonView android:id="@+id/home"
+                android:layout_height="54dp"
+                android:layout_width="match_parent"
+                android:src="@drawable/ic_sysbar_home_default_land"
+                systemui:keyCode="3"
+                android:layout_weight="0"
+                />
+            <View 
                 android:layout_height="match_parent"
                 android:layout_width="match_parent"
-                systemui:minSize="@dimen/navigation_bar_deadzone_size"
-                systemui:maxSize="@dimen/navigation_bar_deadzone_size_max"
-                systemui:holdTime="@integer/navigation_bar_deadzone_hold"
-                systemui:decayTime="@integer/navigation_bar_deadzone_decay"
-                systemui:orientation="vertical"
-                android:layout_gravity="top"
+                android:layout_weight="1"
                 />
-    </FrameLayout>
+            <com.android.systemui.statusbar.policy.KeyButtonView android:id="@+id/back"
+                android:layout_height="54dp"
+                android:layout_width="match_parent"
+                android:src="@drawable/ic_sysbar_back_default_land"
+                systemui:keyCode="4"
+                android:layout_weight="0"
+                />
+            <View
+                android:layout_height="32dp"
+                android:layout_width="match_parent"
+                android:layout_weight="0"
+                />
+        </LinearLayout>
 
-    <!-- not used -->
-    <View
-            android:id="@+id/rot270"
+        <LinearLayout android:id="@+id/rot270"
             android:layout_height="match_parent"
             android:layout_width="match_parent"
+            android:orientation="vertical"
             android:visibility="gone"
-            />
+            >
 
+            <!-- not used -->
+        </LinearLayout>
+    
+    </FrameLayout>
 </com.android.systemui.statusbar.phone.NavigationBarView>
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarView.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarView.java
index 550fc57..22181b8 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarView.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarView.java
@@ -36,14 +36,13 @@ import com.android.internal.statusbar.IStatusBarService;
 import com.android.systemui.R;
 
 public class NavigationBarView extends LinearLayout {
-    final static boolean DEBUG_DEADZONE = false;
-
     final static boolean NAVBAR_ALWAYS_AT_RIGHT = true;
 
     protected IStatusBarService mBarService;
     final Display mDisplay;
     View mCurrentView = null;
     View[] mRotatedViews = new View[4];
+    View mBackground;
     Animator mLastAnimator = null;
 
     public View getRecentsButton() {
@@ -75,13 +74,13 @@ public class NavigationBarView extends LinearLayout {
     }
 
     private void setLights(final boolean on) {
-        float oldAlpha = mCurrentView.getAlpha();
+        float oldAlpha = mBackground.getAlpha();
         android.util.Log.d("NavigationBarView", "animating alpha: " + oldAlpha + " -> "
             + (on ? 1f : 0f));
 
         if (mLastAnimator != null && mLastAnimator.isRunning()) mLastAnimator.cancel();
 
-        mLastAnimator = ObjectAnimator.ofFloat(mCurrentView, "alpha", oldAlpha, on ? 1f : 0f)
+        mLastAnimator = ObjectAnimator.ofFloat(mBackground, "alpha", oldAlpha, on ? 1f : 0f)
             .setDuration(on ? 250 : 1500);
         mLastAnimator.addListener(new AnimatorListenerAdapter() {
             @Override
@@ -93,6 +92,8 @@ public class NavigationBarView extends LinearLayout {
     }
 
     public void onFinishInflate() {
+        mBackground = findViewById(R.id.background);
+
         mRotatedViews[Surface.ROTATION_0] = 
         mRotatedViews[Surface.ROTATION_180] = findViewById(R.id.rot0);
 
@@ -120,10 +121,6 @@ public class NavigationBarView extends LinearLayout {
         mCurrentView = mRotatedViews[rot];
         mCurrentView.setVisibility(View.VISIBLE);
 
-        if (DEBUG_DEADZONE) {
-            mCurrentView.findViewById(R.id.deadzone).setBackgroundColor(0x808080FF);
-        }
-
         android.util.Log.d("NavigationBarView", "reorient(): rot=" + mDisplay.getRotation());
     }
 }
-- 
2.5.0

