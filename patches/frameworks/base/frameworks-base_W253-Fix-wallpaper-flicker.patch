From a0943bd277ed9b5ecaf1c7c1ace7590b1b6da37d Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Mon, 20 Aug 2018 22:57:43 +0300
Subject: [PATCH] Fix for wallpaper flicker on bootup on some targets

We see wallpaper flicker in Android N on some devices. Issue
happens due to wallpaper target keyguard Scrim being destroyed
and new wallpaper target statusbar coming up. This creates a
surface with width & height larger than the device supported
width and height. This causes a momentary jank in UI during
bootup.

diff --git a/packages/SystemUI/src/com/android/systemui/ImageWallpaper.java b/packages/SystemUI/src/com/android/systemui/ImageWallpaper.java
index 907a79e723a..60bb36d6b6f 100644
--- a/packages/SystemUI/src/com/android/systemui/ImageWallpaper.java
+++ b/packages/SystemUI/src/com/android/systemui/ImageWallpaper.java
@@ -500,9 +500,6 @@ protected void onPostExecute(Bitmap b) {
                     }
                     updateSurfaceSize(getSurfaceHolder(), getDefaultDisplayInfo(),
                             false /* forDraw */);
-                    if (mNeedsDrawAfterLoadingWallpaper) {
-                        drawFrame();
-                    }
 
                     mLoader = null;
                     mNeedsDrawAfterLoadingWallpaper = false;
