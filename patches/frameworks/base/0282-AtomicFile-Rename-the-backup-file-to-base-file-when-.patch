From 1aa634ff22b44cc3ad7b467dfb3a8ba00e1efc7e Mon Sep 17 00:00:00 2001
From: songjinshi <songjinshi@xiaomi.com>
Date: Tue, 8 Nov 2016 16:31:01 +0800
Subject: [PATCH 282/296] AtomicFile: Rename the backup file to base file when
 backup exists

Restore the backup file as base file.
---
 core/java/android/util/AtomicFile.java            | 1 +
 core/java/com/android/internal/os/AtomicFile.java | 1 +
 2 files changed, 2 insertions(+)

diff --git a/core/java/android/util/AtomicFile.java b/core/java/android/util/AtomicFile.java
index 6342c8bcb85..26937ee8fce 100644
--- a/core/java/android/util/AtomicFile.java
+++ b/core/java/android/util/AtomicFile.java
@@ -97,6 +97,7 @@ public class AtomicFile {
                 }
             } else {
                 mBaseName.delete();
+                mBackupName.renameTo(mBaseName);
             }
         }
         FileOutputStream str = null;
diff --git a/core/java/com/android/internal/os/AtomicFile.java b/core/java/com/android/internal/os/AtomicFile.java
index 5a83f33c875..3480c127f46 100644
--- a/core/java/com/android/internal/os/AtomicFile.java
+++ b/core/java/com/android/internal/os/AtomicFile.java
@@ -63,6 +63,7 @@ public final class AtomicFile {
                 }
             } else {
                 mBaseName.delete();
+                mBackupName.renameTo(mBaseName);
             }
         }
         FileOutputStream str = null;
-- 
2.11.0

