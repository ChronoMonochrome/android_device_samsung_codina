From 9478150e5bf56e6114657720865fa3d44b512913 Mon Sep 17 00:00:00 2001
From: "Qiushi.Han" <qiushi.han@spreadtrum.com>
Date: Thu, 28 Sep 2017 08:43:09 +0800
Subject: [PATCH 218/296] fix ArraySet crash

---
 core/java/android/util/ArraySet.java | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/core/java/android/util/ArraySet.java b/core/java/android/util/ArraySet.java
index 2eea7df4767..54ac65073ce 100644
--- a/core/java/android/util/ArraySet.java
+++ b/core/java/android/util/ArraySet.java
@@ -154,7 +154,7 @@ public final class ArraySet<E> implements Collection<E>, Set<E> {
     private void allocArrays(final int size) {
         if (size == (BASE_SIZE * 2)) {
             synchronized (ArraySet.class) {
-                if (sTwiceBaseCache != null) {
+                if (sTwiceBaseCache != null && sTwiceBaseCache[1] != null) {
                     final Object[] array = sTwiceBaseCache;
                     try {
                         mArray = array;
@@ -179,7 +179,7 @@ public final class ArraySet<E> implements Collection<E>, Set<E> {
             }
         } else if (size == BASE_SIZE) {
             synchronized (ArraySet.class) {
-                if (sBaseCache != null) {
+                if (sBaseCache != null && sBaseCache[1] != null) {
                     final Object[] array = sBaseCache;
                     try {
                         mArray = array;
-- 
2.11.0

