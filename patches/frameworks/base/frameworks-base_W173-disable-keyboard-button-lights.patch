From a0943bd277ed9b5ecaf1c7c1ace7590b1b6da37d Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Mon, 20 Aug 2018 22:57:43 +0300
Subject: [PATCH] power: force-disable keyboard/button-lights while dreaming

diff --git a/services/core/java/com/android/server/power/PowerManagerService.java b/services/core/java/com/android/server/power/PowerManagerService.java
index 8d26a1d65b3..b18ee15bbbd 100644
--- a/services/core/java/com/android/server/power/PowerManagerService.java
+++ b/services/core/java/com/android/server/power/PowerManagerService.java
@@ -2358,6 +2358,12 @@ private void handleSandman() { // runs on handler thread
                 return; // wait for next cycle
             }
 
+            // keep keyboard/buttons dark if we are dreaming
+            if (wakefulness == WAKEFULNESS_DREAMING ||
+                 wakefulness == WAKEFULNESS_DOZING) {
+                 mButtonsLight.setBrightness(0);
+            }
+
             // Determine whether the dream should continue.
             if (wakefulness == WAKEFULNESS_DREAMING) {
                 if (isDreaming && canDreamLocked()) {
