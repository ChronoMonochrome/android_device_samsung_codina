From 98b995d54415f91063bdc99f3ffb2bb2d94a565c Mon Sep 17 00:00:00 2001
From: riddle_hsu <riddle_hsu@htc.com>
Date: Thu, 4 Feb 2016 15:28:30 +0800
Subject: [PATCH] Also remove activity record if its app is removed.

When forcing stop the package of top activity during screen off,
because the top activity is paused with state, its activity will
not be removed then continue to restart the activity once and
finish it again that is unnecessary.

diff --git a/services/core/java/com/android/server/am/ActivityStack.java b/services/core/java/com/android/server/am/ActivityStack.java
index a47e7c6..bbb5fce 100644
--- a/services/core/java/com/android/server/am/ActivityStack.java
+++ b/services/core/java/com/android/server/am/ActivityStack.java
@@ -4449,7 +4449,7 @@ boolean removeHistoryRecordsForAppLocked(ProcessRecord app) {
                         hasVisibleActivities = true;
                     }
                     final boolean remove;
-                    if ((!r.haveState && !r.stateNotNeeded) || r.finishing) {
+                    if ((!r.haveState && !r.stateNotNeeded) || r.finishing || app.removed) {
                         // Don't currently have state for the activity, or
                         // it is finishing -- always remove it.
                         remove = true;
