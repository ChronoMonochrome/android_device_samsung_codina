From 0ed89ef55e17f4654edd48a8a02153cddc526a5a Mon Sep 17 00:00:00 2001
From: Mitchell Orsucci <mitchellorsucci@gmail.com>
Date: Mon, 23 Oct 2017 08:28:03 -0700
Subject: [PATCH 139/296] Fix shared libraries loading during backup

When backup or restore is triggered on a non running
application the shared libraries are not loaded. This
will result in ClassNotFoundException when launching
an application referenced a shared library. Fix is to
add a GET_SHARED_LIBRARIES flag when calling
getApplicationInfo, then loading of shared library
when application launch is triggered by backup.
---
 services/core/java/com/android/server/am/ActivityManagerService.java | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/services/core/java/com/android/server/am/ActivityManagerService.java b/services/core/java/com/android/server/am/ActivityManagerService.java
index da285489d04..cb6ad206a14 100644
--- a/services/core/java/com/android/server/am/ActivityManagerService.java
+++ b/services/core/java/com/android/server/am/ActivityManagerService.java
@@ -18559,7 +18559,7 @@ public class ActivityManagerService extends IActivityManager.Stub
         IPackageManager pm = AppGlobals.getPackageManager();
         ApplicationInfo app = null;
         try {
-            app = pm.getApplicationInfo(packageName, 0, userId);
+            app = pm.getApplicationInfo(packageName, STOCK_PM_FLAGS, userId);
         } catch (RemoteException e) {
             // can't happen; package manager is process-local
         }
-- 
2.11.0

