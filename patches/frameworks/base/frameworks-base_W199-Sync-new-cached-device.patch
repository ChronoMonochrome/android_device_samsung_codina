From a2ed65c971d14fa3e3891e8f7a61ff4aedddd57f Mon Sep 17 00:00:00 2001
From: venkata Jagadeesh <vjagad@codeaurora.org>
Date: Thu, 1 Oct 2015 13:12:03 +0530
Subject: [PATCH] Sync Preference in UI for new cached device

Use Case: Inquiry results not updated to UI when A2DP
streaming is initiated.

Failure: Inquiry results updated to settings APP but
it's not reflecting in UI.

Steps:
 1. A2DP streaming from DUT.
 2. OPP Rx initiated from remote.
 3. Initiating inquiry from DUT.

Root Cause: No callback to UI to sync the preference
parameter of new cached device in DeviceFoundHandler class.

Fix: Create preference in UI whenever new cached device is added.

diff --git a/packages/SettingsLib/src/com/android/settingslib/bluetooth/BluetoothEventManager.java b/packages/SettingsLib/src/com/android/settingslib/bluetooth/BluetoothEventManager.java
index 28105e2630a..578a6b5bec3 100755
--- a/packages/SettingsLib/src/com/android/settingslib/bluetooth/BluetoothEventManager.java
+++ b/packages/SettingsLib/src/com/android/settingslib/bluetooth/BluetoothEventManager.java
@@ -218,6 +218,8 @@ public void onReceive(Context context, Intent intent,
                 cachedDevice = mDeviceManager.addDevice(mLocalAdapter, mProfileManager, device);
                 Log.d(TAG, "DeviceFoundHandler created new CachedBluetoothDevice: "
                         + cachedDevice);
+                // callback to UI to create Preference for new device
+                dispatchDeviceAdded(cachedDevice);
             }
             cachedDevice.setRssi(rssi);
             cachedDevice.setBtClass(btClass);
