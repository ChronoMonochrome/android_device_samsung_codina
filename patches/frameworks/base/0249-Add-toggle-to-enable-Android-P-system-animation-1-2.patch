From b3dcd87d64c5209e9a5cdcbb5464fc6f59afd1f5 Mon Sep 17 00:00:00 2001
From: Pranav Vashi <neobuddy89@gmail.com>
Date: Mon, 2 Apr 2018 00:10:08 +0530
Subject: [PATCH 249/296] Add toggle to enable Android P system animation [1/2]

---
 core/java/android/provider/Settings.java             |  6 ++++++
 core/java/android/view/animation/AnimationUtils.java | 13 ++++++++++---
 2 files changed, 16 insertions(+), 3 deletions(-)

diff --git a/core/java/android/provider/Settings.java b/core/java/android/provider/Settings.java
index fb525f5d614..1cfe93ae215 100755
--- a/core/java/android/provider/Settings.java
+++ b/core/java/android/provider/Settings.java
@@ -10403,6 +10403,12 @@ public final class Settings {
                 "storage_settings_clobber_threshold";
 
         /**
+         * Default animation
+         * @hide
+         */
+        public static final String SYSTEM_DEFAULT_ANIMATION = "system_default_animation";
+
+        /**
          * Settings to backup. This is here so that it's in the same place as the settings
          * keys and easy to update.
          *
diff --git a/core/java/android/view/animation/AnimationUtils.java b/core/java/android/view/animation/AnimationUtils.java
index 01d98c1da98..4d46b1b9851 100644
--- a/core/java/android/view/animation/AnimationUtils.java
+++ b/core/java/android/view/animation/AnimationUtils.java
@@ -24,6 +24,8 @@ import android.content.res.Resources.NotFoundException;
 import android.content.res.Resources.Theme;
 import android.content.res.XmlResourceParser;
 import android.os.SystemClock;
+import android.os.UserHandle;
+import android.provider.Settings;
 import android.util.AttributeSet;
 import android.util.Xml;
 import android.util.PathParser;
@@ -103,8 +105,13 @@ public class AnimationUtils {
     public static Animation loadAnimation(Context context, @AnimRes int id)
             throws NotFoundException {
 
-        String name = context.getResources().getResourceEntryName(id);
-        switch(name) {
+        int defStyle = Settings.Global.getInt(context.getContentResolver(),
+                            Settings.Global.SYSTEM_DEFAULT_ANIMATION, 0);
+
+        if (defStyle == 0)
+            return loadAnimationFromXml(context, id);
+
+        switch (context.getResources().getResourceEntryName(id)) {
             case "activity_open_enter" : return getActivityOpenEnterAnim();
             case "activity_open_exit" : return getActivityOpenExitAnim();
             case "activity_close_enter" : return getActivityCloseEnterAnim();
@@ -113,7 +120,7 @@ public class AnimationUtils {
             case "task_open_exit" : return getTaskOpenExitAnim();
             case "task_close_enter" : return getTaskCloseEnterAnim();
             case "task_close_exit" : return getTaskCloseExitAnim();
-            default: return loadAnimationFromXml(context,id);
+            default: return loadAnimationFromXml(context, id);
         }
     }
 
-- 
2.11.0

