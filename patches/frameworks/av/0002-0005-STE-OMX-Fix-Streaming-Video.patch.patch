From 29f11ab68474a8dd306e48be83d1d4e263a9cfb0 Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Sun, 17 May 2015 00:26:41 +0300
Subject: [PATCH 02/12] 0005-STE-OMX-Fix-Streaming-Video.patch

Change-Id: I922690a5f809df34b623d0bb5e3459dc8e2a7cfb
---
 media/libstagefright/ACodec.cpp | 4 ++++
 1 file changed, 4 insertions(+)
 mode change 100755 => 100644 media/libstagefright/ACodec.cpp

diff --git a/media/libstagefright/ACodec.cpp b/media/libstagefright/ACodec.cpp
old mode 100755
new mode 100644
index 65e5d32..338810c
--- a/media/libstagefright/ACodec.cpp
+++ b/media/libstagefright/ACodec.cpp
@@ -596,11 +596,15 @@ status_t ACodec::allocateBuffersOnPort(OMX_U32 portIndex) {
 
     status_t err;
     if (mNativeWindow != NULL && portIndex == kPortIndexOutput) {
+#ifdef STE_HARDWARE
+        err = allocateOutputBuffersFromNativeWindow();
+#else
         if (mStoreMetaDataInOutputBuffers) {
             err = allocateOutputMetaDataBuffers();
         } else {
             err = allocateOutputBuffersFromNativeWindow();
         }
+#endif
     } else {
         OMX_PARAM_PORTDEFINITIONTYPE def;
         InitOMXParams(&def);
-- 
1.9.1

