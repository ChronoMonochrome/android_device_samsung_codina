From 692e5e2fb7d06c3102d1276f56b74b0da913a000 Mon Sep 17 00:00:00 2001
From: Mridul Singh <mridulsingh@codeaurora.org>
Date: Wed, 1 Mar 2017 11:37:34 -0800
Subject: [PATCH 38/57] Camera: Add NULL check on mDevice to avoid crash.

NULL check on mDevice before calling cancelAutoFocus.
Also adding the same check in disconnect.
---
 services/camera/libcameraservice/api1/Camera2Client.cpp | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

diff --git a/services/camera/libcameraservice/api1/Camera2Client.cpp b/services/camera/libcameraservice/api1/Camera2Client.cpp
index 585d2ebd5..f8f72d880 100644
--- a/services/camera/libcameraservice/api1/Camera2Client.cpp
+++ b/services/camera/libcameraservice/api1/Camera2Client.cpp
@@ -452,9 +452,10 @@ binder::Status Camera2Client::disconnect() {
 
     ALOGV("Camera %d: Disconnecting device", mCameraId);
 
-    mDevice->disconnect();
-
-    mDevice.clear();
+    if (mDevice != nullptr) {
+        mDevice->disconnect();
+        mDevice.clear();
+    }
 
     CameraService::Client::disconnect();
 
@@ -906,6 +907,7 @@ void Camera2Client::stopPreview() {
     Mutex::Autolock icl(mBinderSerializationLock);
     status_t res;
     if ( (res = checkPid(__FUNCTION__) ) != OK) return;
+    if (mDevice == 0) return;
     stopPreviewL();
 }
 
@@ -1371,7 +1373,7 @@ status_t Camera2Client::cancelAutoFocus() {
     ALOGV("%s: Camera %d", __FUNCTION__, mCameraId);
     status_t res;
     if ( (res = checkPid(__FUNCTION__) ) != OK) return res;
-
+    if (mDevice == 0) return NO_INIT;
     int triggerId;
     {
         SharedParameters::Lock l(mParameters);
-- 
2.11.0

