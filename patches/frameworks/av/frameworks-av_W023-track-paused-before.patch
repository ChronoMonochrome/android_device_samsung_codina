From 6c134513fb328761fc781fd59a6bcff39c5e8681 Mon Sep 17 00:00:00 2001
From: Weiyin Jiang <wjiang@codeaurora.org>
Date: Mon, 14 Aug 2017 14:19:40 +0800
Subject: [PATCH] audio: don't apply ramp if track is paused before the first mix

If a track is paused right after start before it gets a chance to mix
the first frame. Don't apply volume ramp if it resumes later.

diff --git a/services/audioflinger/Threads.cpp b/services/audioflinger/Threads.cpp
index 01342cf..ed7a200 100644
--- a/services/audioflinger/Threads.cpp
+++ b/services/audioflinger/Threads.cpp
@@ -4293,7 +4293,9 @@ AudioFlinger::PlaybackThread::mixer_state AudioFlinger::MixerThread::prepareTrac
                 track->mFillingUpStatus = Track::FS_ACTIVE;
                 if (track->mState == TrackBase::RESUMING) {
                     track->mState = TrackBase::ACTIVE;
-                    param = AudioMixer::RAMP_VOLUME;
+                    if (cblk->mServer != 0) {
+                        param = AudioMixer::RAMP_VOLUME;
+                    }
                 }
                 mAudioMixer->setParameter(name, AudioMixer::RESAMPLE, AudioMixer::RESET, NULL);
                 mLeftVolFloat = -1.0;
