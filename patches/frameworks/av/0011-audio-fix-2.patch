From 9a3d2398f433ee5b3205a84fa444c2fcea9444ea Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Mon, 25 May 2015 17:53:17 +0300
Subject: [PATCH 11/13] audio fix[2]

Change-Id: I45ed32f52d1be41e21cf524a848b344691c96739
---
 media/libmedia/AudioSystem.cpp  | 2 +-
 services/audiopolicy/Android.mk | 9 ++-------
 2 files changed, 3 insertions(+), 8 deletions(-)

diff --git a/media/libmedia/AudioSystem.cpp b/media/libmedia/AudioSystem.cpp
index 9cae21c..a9fa53e 100644
--- a/media/libmedia/AudioSystem.cpp
+++ b/media/libmedia/AudioSystem.cpp
@@ -646,7 +646,7 @@ audio_io_handle_t AudioSystem::getOutput(audio_stream_type_t stream,
 {
     const sp<IAudioPolicyService>& aps = AudioSystem::get_audio_policy_service();
     if (aps == 0) return 0;
-    return aps->getOutput(stream, samplingRate, format, channelMask, flags, offloadInfo);
+    return aps->getOutput(stream, samplingRate, format, channelMask, flags, NULL);
 }
 
 status_t AudioSystem::getOutputForAttr(const audio_attributes_t *attr,
diff --git a/services/audiopolicy/Android.mk b/services/audiopolicy/Android.mk
index b2c69ed..ea96b4d 100644
--- a/services/audiopolicy/Android.mk
+++ b/services/audiopolicy/Android.mk
@@ -2,6 +2,8 @@ LOCAL_PATH:= $(call my-dir)
 
 include $(CLEAR_VARS)
 
+USE_LEGACY_AUDIO_POLICY:=1
+
 LOCAL_SRC_FILES:= \
     AudioPolicyService.cpp \
     AudioPolicyEffects.cpp
@@ -33,13 +35,6 @@ LOCAL_SHARED_LIBRARIES := \
     libhardware_legacy \
     libserviceutility
 
-USE_LEGACY_AUDIO_POLICY := true
-
-ifneq ($(USE_LEGACY_AUDIO_POLICY), 1)
-LOCAL_SHARED_LIBRARIES += \
-    libaudiopolicymanager
-endif
-
 LOCAL_CFLAGS += -DHAVE_PRE_KITKAT_AUDIO_BLOB
 LOCAL_CFLAGS += -DHAVE_PRE_KITKAT_AUDIO_POLICY_BLOB
 
-- 
1.9.1

