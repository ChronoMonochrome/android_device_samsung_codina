Subject: [PATCH] fix ArraySet crash

diff --git a/core/java/android/util/ArraySet.java b/core/java/android/util/ArraySet.java
index a02c070..4d1a51c 100644
--- a/core/java/android/util/ArraySet.java
+++ b/core/java/android/util/ArraySet.java
@@ -154,7 +154,7 @@
     private void allocArrays(final int size) {
         if (size == (BASE_SIZE * 2)) {
             synchronized (ArraySet.class) {
-                if (sTwiceBaseCache != null) {
+                if (sTwiceBaseCache != null && sTwiceBaseCache[1] != null) {
                     final Object[] array = sTwiceBaseCache;
                     try {
                         mArray = array;
@@ -179,7 +179,7 @@
             }
         } else if (size == BASE_SIZE) {
             synchronized (ArraySet.class) {
-                if (sBaseCache != null) {
+                if (sBaseCache != null && sBaseCache[1] != null) {
                     final Object[] array = sBaseCache;
                     try {
                         mArray = array;
