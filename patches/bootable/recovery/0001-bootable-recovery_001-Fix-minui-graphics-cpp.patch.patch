From f0dd8f45016eec5e814c47c2238ed768b311656d Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Sat, 25 Aug 2018 17:11:49 +0300
Subject: [PATCH 01/15] bootable-recovery_001-Fix-minui-graphics-cpp.patch

Change-Id: I92054851dadb7ae671bfd753eef72bdc711926af
---
 minuitwrp/graphics.cpp | 25 +++++++++++++++++++++++++
 1 file changed, 25 insertions(+)

diff --git a/minuitwrp/graphics.cpp b/minuitwrp/graphics.cpp
index 3dc88d9d..1e8a1230 100644
--- a/minuitwrp/graphics.cpp
+++ b/minuitwrp/graphics.cpp
@@ -292,7 +292,11 @@ static void get_memory_surface(GGLSurface* ms) {
     ms->format = gr_draw->format;
 }
 
+#ifdef STE_HARDWARE
+int gr_init_real(void)
+#else
 int gr_init(void)
+#endif
 {
     gr_draw = NULL;
 
@@ -371,6 +375,27 @@ int gr_init(void)
     return 0;
 }
 
+#ifdef STE_HARDWARE
+/*
+ * FIXME: This is a total hack.
+ *
+ * Round 1
+ * framebuffer: fd 4 (480 x 800)
+ *
+ * Round 2
+ * framebuffer: fd 6 (480 x 800)
+ *
+*/
+int gr_init(void) {
+    int ret;
+    // Round 1
+    gr_init_real();
+    // Return the result of round 2
+    ret = gr_init_real();
+    return ret;
+}
+#endif
+
 void gr_exit(void)
 {
     gr_backend->exit(gr_backend);
-- 
2.11.0

