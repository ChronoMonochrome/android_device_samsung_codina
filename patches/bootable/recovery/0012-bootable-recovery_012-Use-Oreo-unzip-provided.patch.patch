From e993b5f61aacfe9848f4cca238baa09fc45a8cdb Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Sat, 25 Aug 2018 17:11:50 +0300
Subject: [PATCH 12/15] bootable-recovery_012-Use-Oreo-unzip-provided.patch

Change-Id: I9ed0bac59810f75217513eda7c22241c7797be65
---
 prebuilt/Android.mk | 20 +++++++++++++-------
 1 file changed, 13 insertions(+), 7 deletions(-)

diff --git a/prebuilt/Android.mk b/prebuilt/Android.mk
index 2bd2e6f0..252f0da5 100644
--- a/prebuilt/Android.mk
+++ b/prebuilt/Android.mk
@@ -21,13 +21,19 @@ else
 	RELINK_SOURCE_FILES += $(TARGET_OUT_EXECUTABLES)/sh
 	RELINK_SOURCE_FILES += $(TARGET_OUT_SHARED_LIBRARIES)/libcrypto.so
 	ifeq ($(shell test $(PLATFORM_SDK_VERSION) -ge 23; echo $$?),0)
-	    RELINK_SOURCE_FILES += $(TARGET_RECOVERY_ROOT_OUT)/sbin/toybox
-	    ifneq ($(wildcard external/zip/Android.mk),)
-                RELINK_SOURCE_FILES += $(TARGET_OUT_OPTIONAL_EXECUTABLES)/zip
-	    endif
-	    ifneq ($(wildcard external/unzip/Android.mk),)
-                RELINK_SOURCE_FILES += $(TARGET_OUT_OPTIONAL_EXECUTABLES)/unzip
-	    endif
+		RELINK_SOURCE_FILES += $(TARGET_RECOVERY_ROOT_OUT)/sbin/toybox
+
+		ifneq ($(wildcard external/zip/Android.mk),)
+			RELINK_SOURCE_FILES += $(TARGET_OUT_OPTIONAL_EXECUTABLES)/zip
+		endif
+		ifeq ($(shell test $(PLATFORM_SDK_VERSION) -ge 27; echo $$?),0)
+			# system/core/libziparchive provides unzip
+			RELINK_SOURCE_FILES += $(TARGET_OUT_EXECUTABLES)/unzip
+		else
+			ifneq ($(wildcard external/unzip/Android.mk),)
+				RELINK_SOURCE_FILES += $(TARGET_OUT_OPTIONAL_EXECUTABLES)/unzip
+			endif
+		endif
 	endif
 endif
 RELINK_SOURCE_FILES += $(TARGET_RECOVERY_ROOT_OUT)/sbin/pigz
-- 
2.11.0

