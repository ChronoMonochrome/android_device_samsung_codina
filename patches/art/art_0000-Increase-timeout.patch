From e1dee75473a64063a896f57c205610f291920171 Mon Sep 17 00:00:00 2001
From: Dmitry Grinberg <dmitrygr@gmail.com>
Date: Wed, 4 Nov 2015 10:22:01 +0000
Subject: [PATCH] dex2oat: Increase timeout to allow slow CPUs to finish
 compilation

diff --git a/dex2oat/dex2oat.cc b/dex2oat/dex2oat.cc
index d2b8ba1..f3f542d 100644
--- a/dex2oat/dex2oat.cc
+++ b/dex2oat/dex2oat.cc
@@ -498,10 +498,10 @@ class WatchDog {
   // desktop. Debug builds are slower so they have larger timeouts.
   static constexpr int64_t kWatchdogSlowdownFactor = kIsDebugBuild ? 5U : 1U;
 
-  // 9.5 minutes scaled by kSlowdownFactor. This is slightly smaller than the Package Manager
-  // watchdog (PackageManagerService.WATCHDOG_TIMEOUT, 10 minutes), so that dex2oat will abort
+  // 59.5 minutes scaled by kSlowdownFactor. This is slightly smaller than the Package Manager
+  // watchdog (PackageManagerService.WATCHDOG_TIMEOUT, 60 minutes), so that dex2oat will abort
   // itself before that watchdog would take down the system server.
-  static constexpr int64_t kWatchDogTimeoutSeconds = kWatchdogSlowdownFactor * (9 * 60 + 30);
+  static constexpr int64_t kWatchDogTimeoutSeconds = kWatchdogSlowdownFactor * (59 * 60 + 30);
 
   static constexpr int64_t kDefaultWatchdogTimeoutInMS =
       kWatchdogVerifyMultiplier * kWatchDogTimeoutSeconds * 1000;
