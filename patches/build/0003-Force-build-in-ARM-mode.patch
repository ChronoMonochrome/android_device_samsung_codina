From 1492e06d412ad292887b332eefca1e3faf30326b Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Fri, 5 Jun 2015 05:51:54 +0300
Subject: [PATCH 3/4] Force build in ARM mode

Change-Id: Ib3253e7d7b110243083762e77ccd8b5371d80c01
---
 core/binary.mk                 |  6 +++---
 core/combo/TARGET_linux-arm.mk | 19 +++----------------
 2 files changed, 6 insertions(+), 19 deletions(-)

diff --git a/core/binary.mk b/core/binary.mk
index 8ce874e..905a054 100644
--- a/core/binary.mk
+++ b/core/binary.mk
@@ -222,17 +222,17 @@ endif
 LOCAL_ARM_MODE := $(strip $(LOCAL_ARM_MODE))
 ifeq ($(TARGET_ARCH),arm)
 arm_objects_mode := $(if $(LOCAL_ARM_MODE),$(LOCAL_ARM_MODE),arm)
-normal_objects_mode := $(if $(LOCAL_ARM_MODE),$(LOCAL_ARM_MODE),thumb)
+normal_objects_mode := $(if $(LOCAL_ARM_MODE),$(LOCAL_ARM_MODE),arm)
 
 # Read the values from something like TARGET_arm_CFLAGS or
 # TARGET_thumb_CFLAGS.  HOST_(arm|thumb)_CFLAGS values aren't
 # actually used (although they are usually empty).
 ifeq ($(strip $(LOCAL_CLANG)),true)
 arm_objects_cflags := $($(my_prefix)$(arm_objects_mode)_CLANG_CFLAGS)
-normal_objects_cflags := $($(my_prefix)$(normal_objects_mode)_CLANG_CFLAGS)
+normal_objects_cflags := $($(my_prefix)$(arm_objects_mode)_CLANG_CFLAGS)
 else
 arm_objects_cflags := $($(my_prefix)$(arm_objects_mode)_CFLAGS)
-normal_objects_cflags := $($(my_prefix)$(normal_objects_mode)_CFLAGS)
+normal_objects_cflags := $($(my_prefix)$(arm_objects_mode)_CFLAGS)
 endif
 
 else
diff --git a/core/combo/TARGET_linux-arm.mk b/core/combo/TARGET_linux-arm.mk
index 3497662..c6b01b4 100644
--- a/core/combo/TARGET_linux-arm.mk
+++ b/core/combo/TARGET_linux-arm.mk
@@ -68,30 +68,17 @@ endif
 
 TARGET_NO_UNDEFINED_LDFLAGS := -Wl,--no-undefined
 
-TARGET_arm_CFLAGS :=    -O2 \
+TARGET_arm_CFLAGS :=    -O3 \
                         -fomit-frame-pointer \
                         -fstrict-aliasing    \
                         -funswitch-loops
 
 # Modules can choose to compile some source as thumb.
-TARGET_thumb_CFLAGS :=  -mthumb \
-                        -Os \
+TARGET_thumb_CFLAGS :=  -marm \
+                        -O3 \
                         -fomit-frame-pointer \
                         -fno-strict-aliasing
 
-# Set FORCE_ARM_DEBUGGING to "true" in your buildspec.mk
-# or in your environment to force a full arm build, even for
-# files that are normally built as thumb; this can make
-# gdb debugging easier.  Don't forget to do a clean build.
-#
-# NOTE: if you try to build a -O0 build with thumb, several
-# of the libraries (libpv, libwebcore, libkjs) need to be built
-# with -mlong-calls.  When built at -O0, those libraries are
-# too big for a thumb "BL <label>" to go from one end to the other.
-ifeq ($(FORCE_ARM_DEBUGGING),true)
-  TARGET_arm_CFLAGS += -fno-omit-frame-pointer -fno-strict-aliasing
-  TARGET_thumb_CFLAGS += -marm -fno-omit-frame-pointer
-endif
 
 ifeq ($(TARGET_DISABLE_ARM_PIE),true)
    PIE_GLOBAL_CFLAGS :=
-- 
1.9.1

