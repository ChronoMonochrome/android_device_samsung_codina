From 9fb40a1f29aa96d57450733099aa307c113a8373 Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Sun, 24 Jan 2016 10:09:20 +0700
Subject: [PATCH 4/4] Change kernel toolchain

Change-Id: I5a0dd9670a649579e07a637f49c3bac282806d63
---
 core/Makefile                  |  2 +-
 core/combo/TARGET_linux-arm.mk |  2 +-
 core/kernel_config.mk          | 44 ++----------------------------------------
 3 files changed, 4 insertions(+), 44 deletions(-)

diff --git a/core/Makefile b/core/Makefile
index 58a502f..c189259 100755
--- a/core/Makefile
+++ b/core/Makefile
@@ -819,7 +819,7 @@ endif
 
 $(RECOVERY_RESOURCE_ZIP): $(INSTALLED_RECOVERYIMAGE_TARGET)
 	$(hide) mkdir -p $(dir $@)
-	$(hide) find $(TARGET_RECOVERY_ROOT_OUT)/res -type f | sort | zip -0qrj $@ -@
+	$(hide) touch $(RECOVERY_RESOURCE_ZIP)
 
 else
 INSTALLED_RECOVERYIMAGE_TARGET :=
diff --git a/core/combo/TARGET_linux-arm.mk b/core/combo/TARGET_linux-arm.mk
index 8038c76..7ddd33b 100644
--- a/core/combo/TARGET_linux-arm.mk
+++ b/core/combo/TARGET_linux-arm.mk
@@ -44,7 +44,7 @@ endif
 # 4.8 is default in my optimizations, as it gives noticable performance boost
 ifeq ($(strip $(TARGET_GCC_VERSION_EXP)),)
 #TARGET_GCC_VERSION := 4.7
-TARGET_GCC_VERSION := 4.8
+TARGET_GCC_VERSION := 5.2
 else
 TARGET_GCC_VERSION := $(TARGET_GCC_VERSION_EXP)
 endif
diff --git a/core/kernel_config.mk b/core/kernel_config.mk
index 2e1b1c4..c878beb 100755
--- a/core/kernel_config.mk
+++ b/core/kernel_config.mk
@@ -1,46 +1,6 @@
-# sweater-vest compat
-ifeq ($(HOST_OS),darwin)
-  MAKE_FLAGS := C_INCLUDE_PATH=$(ANDROID_BUILD_TOP)/external/elfutils/libelf
-  TARGET_KERNEL_USE_AOSP_TOOLCHAIN := true
-endif
-
-ifneq ($(strip $(BONE_STOCK)),)
-  TARGET_KERNEL_USE_AOSP_TOOLCHAIN := true
-endif
-
-# sideways compat
-ifeq ($(USE_AOSP_TOOLCHAINS),true)
-    TARGET_KERNEL_USE_AOSP_TOOLCHAIN := true
-endif
-
 # default
 ifeq ($(TARGET_KERNEL_CUSTOM_TOOLCHAIN),)
-    TARGET_KERNEL_CUSTOM_TOOLCHAIN := 4.9
+    TARGET_KERNEL_CUSTOM_TOOLCHAIN := armv7a-linux-gnueabihf-5.2
 endif
 
-# allow setting the cpu variant for unsupported cpu's like cortex-a7
-ifeq ($(TARGET_KERNEL_CPU_VARIANT),)
-    TARGET_KERNEL_CPU_VARIANT := $(cpu_for_optimizations)
-else
-    TARGET_KERNEL_CPU_VARIANT := $(TARGET_KERNEL_CPU_VARIANT)
-endif
-
-# meat and potatoes
-ifeq ($(TARGET_KERNEL_USE_AOSP_TOOLCHAIN),true)
-    ifneq ($(TARGET_KERNEL_CUSTOM_AOSP_TOOLCHAIN),)
-        TARGET_KERNEL_CUSTOM_TOOLCHAIN:=$(TARGET_KERNEL_CUSTOM_AOSP_TOOLCHAIN)
-    else
-        TARGET_KERNEL_CUSTOM_TOOLCHAIN:=arm-eabi-4.7
-    endif
-
-    TOOL_PREFIX:=$(ANDROID_BUILD_TOP)/prebuilts/gcc/$(HOST_PREBUILT_TAG)/arm/$(TARGET_KERNEL_CUSTOM_TOOLCHAIN)/bin/arm-eabi-
-else
-    T_K_C_T_STRIPPER := $(shell echo $(TARGET_KERNEL_CUSTOM_TOOLCHAIN) | sed -e 's/[a-z]//g')
-    T_K_C_T_DASHER := $(shell echo $(T_K_C_T_STRIPPER) | sed -e 's/-//g')
-    T_K_C_T := $(T_K_C_T_DASHER)
-
-    # prefix auto-determination. hollah for a dollah.
-    POSSIBLE_TOOLCHAIN_PREFIXES := arm-eabi- arm-gnueabi- arm-gnueabihf- arm-linux-androideabi-
-
-    TOOL_PREFIX := $(patsubst %-gcc,%-,$(firstword $(foreach var, $(POSSIBLE_TOOLCHAIN_PREFIXES), $(wildcard $(ANDROID_BUILD_TOP)/prebuilts/gcc/linux-x86/arm/$(var)$(T_K_C_T)/bin/$(var)gcc))))
-endif
+TOOL_PREFIX:=$(ANDROID_BUILD_TOP)/prebuilts/gcc/$(HOST_PREBUILT_TAG)/arm/$(TARGET_KERNEL_CUSTOM_TOOLCHAIN)/bin/armv7a-linux-gnueabihf-
-- 
2.5.0

