From 97335741b41659335f85eb85fac9c1c9e82d9554 Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Sun, 3 May 2015 22:36:11 +0300
Subject: [PATCH] Don't build recovery_from_boot.p

Change-Id: Ie569c1b316e15e112b337883aa76d7699a01d3ef
Signed-off-by: Shilin Victor <chrono.monochrome@gmail.com>
---
 core/Makefile                          | 27 +++++++++++----------------
 core/generate_extra_images.mk          |  4 ++--
 tools/releasetools/common.py           |  2 ++
 tools/releasetools/make_recovery_patch |  4 ++--
 4 files changed, 17 insertions(+), 20 deletions(-)

diff --git a/core/Makefile b/core/Makefile
index 68d09fc..9423f33 100644
--- a/core/Makefile
+++ b/core/Makefile
@@ -1086,22 +1086,17 @@ SYSTEMIMAGE_SOURCE_DIR := $(TARGET_OUT)
 # as the source (since they are very similar).  Generate the patch so
 # we can see how big it's going to be, and include that in the system
 # image size check calculation.
-ifneq ($(INSTALLED_RECOVERYIMAGE_TARGET),)
-intermediates := $(call intermediates-dir-for,PACKAGING,recovery_patch)
-RECOVERY_FROM_BOOT_PATCH := $(intermediates)/recovery_from_boot.p
-$(RECOVERY_FROM_BOOT_PATCH): $(INSTALLED_RECOVERYIMAGE_TARGET) \
-                             $(INSTALLED_BOOTIMAGE_TARGET) \
-			     $(HOST_OUT_EXECUTABLES)/imgdiff \
-	                     $(HOST_OUT_EXECUTABLES)/bsdiff
-	@echo -e ${CL_CYN}"Construct recovery from boot"${CL_RST}
-	mkdir -p $(dir $@)
-ifeq ($(TARGET_NOT_USE_GZIP_RECOVERY_RAMDISK),true)
-	PATH=$(HOST_OUT_EXECUTABLES):$$PATH $(HOST_OUT_EXECUTABLES)/bsdiff $(INSTALLED_BOOTIMAGE_TARGET) $(INSTALLED_RECOVERYIMAGE_TARGET) $@
-else
-	PATH=$(HOST_OUT_EXECUTABLES):$$PATH $(HOST_OUT_EXECUTABLES)/imgdiff $(INSTALLED_BOOTIMAGE_TARGET) $(INSTALLED_RECOVERYIMAGE_TARGET) $@
-endif
-endif
-
+#ifneq ($(INSTALLED_RECOVERYIMAGE_TARGET),)
+#intermediates := $(call intermediates-dir-for,PACKAGING,recovery_patch)
+#RECOVERY_FROM_BOOT_PATCH := $(intermediates)/recovery_from_boot.p
+#$(RECOVERY_FROM_BOOT_PATCH): $(INSTALLED_RECOVERYIMAGE_TARGET) \
+#                            $(INSTALLED_BOOTIMAGE_TARGET) \
+#			     $(HOST_OUT_EXECUTABLES)/imgdiff \
+#	                     $(HOST_OUT_EXECUTABLES)/bsdiff
+#	@echo -e ${CL_CYN}"Construct recovery from boot"${CL_RST}
+#	mkdir -p $(dir $@)
+#	PATH=$(HOST_OUT_EXECUTABLES):$$PATH $(HOST_OUT_EXECUTABLES)/imgdiff $(INSTALLED_BOOTIMAGE_TARGET) $(INSTALLED_RECOVERYIMAGE_TARGET) $@
+#endif
 
 $(INSTALLED_SYSTEMIMAGE): $(BUILT_SYSTEMIMAGE) $(RECOVERY_FROM_BOOT_PATCH) | $(ACP)
 	@echo -e ${CL_CYN}"Install system fs image: $@"${CL_RST}
diff --git a/core/generate_extra_images.mk b/core/generate_extra_images.mk
index 8cd18fd..5e9976b 100644
--- a/core/generate_extra_images.mk
+++ b/core/generate_extra_images.mk
@@ -22,8 +22,8 @@ INSTALLED_SEC_BOOTIMAGE_TARGET := $(PRODUCT_OUT)/boot.img.secure
 INSTALLED_SEC_RECOVERYIMAGE_TARGET := $(PRODUCT_OUT)/recovery.img.secure
 
 ifneq ($(BUILD_TINY_ANDROID),true)
-intermediates := $(call intermediates-dir-for,PACKAGING,recovery_patch)
-RECOVERY_FROM_BOOT_PATCH := $(intermediates)/recovery_from_boot.p
+#intermediates := $(call intermediates-dir-for,PACKAGING,recovery_patch)
+#RECOVERY_FROM_BOOT_PATCH := $(intermediates)/recovery_from_boot.p
 endif
 
 ifndef TARGET_SHA_TYPE
diff --git a/tools/releasetools/common.py b/tools/releasetools/common.py
index 55fdb2b..214f0df 100644
--- a/tools/releasetools/common.py
+++ b/tools/releasetools/common.py
@@ -1224,6 +1224,8 @@ def MakeRecoveryPatch(input_dir, output_sink, recovery_img, boot_img,
   common.LoadInfoDict() on the input target_files.
   """
 
+  return
+
   if info_dict is None:
     info_dict = OPTIONS.info_dict
 
diff --git a/tools/releasetools/make_recovery_patch b/tools/releasetools/make_recovery_patch
index 08d1450..90fb6a4 100755
--- a/tools/releasetools/make_recovery_patch
+++ b/tools/releasetools/make_recovery_patch
@@ -49,5 +49,5 @@ def main(argv):
   common.MakeRecoveryPatch(input_dir, output_sink, recovery_img, boot_img)
 
 
-if __name__ == '__main__':
-  main(sys.argv[1:])
+#if __name__ == '__main__':
+#  main(sys.argv[1:])
-- 
1.9.1

