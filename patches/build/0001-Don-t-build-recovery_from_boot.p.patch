From 9f5cda526ac2a08a5ea6c70a08a8c358f5957176 Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Sat, 5 Sep 2015 04:19:24 +0300
Subject: [PATCH 1/2] Don't build recovery_from_boot.p

Change-Id: I4d4d53d647f91775e12c62d65dbb71ebcc119864
---
 core/Makefile                          | 17 -----------------
 tools/releasetools/common.py           |  2 ++
 tools/releasetools/make_recovery_patch |  4 ++--
 3 files changed, 4 insertions(+), 19 deletions(-)

diff --git a/core/Makefile b/core/Makefile
index 33da636..8ba06d3 100644
--- a/core/Makefile
+++ b/core/Makefile
@@ -991,23 +991,6 @@ $(BUILT_SYSTEMIMAGE): $(FULL_SYSTEMIMAGE_DEPS) $(INSTALLED_FILES_FILE)
 INSTALLED_SYSTEMIMAGE := $(PRODUCT_OUT)/system.img
 SYSTEMIMAGE_SOURCE_DIR := $(TARGET_OUT)
 
-# The system partition needs room for the recovery image as well.  We
-# now store the recovery image as a binary patch using the boot image
-# as the source (since they are very similar).  Generate the patch so
-# we can see how big it's going to be, and include that in the system
-# image size check calculation.
-ifneq ($(INSTALLED_RECOVERYIMAGE_TARGET),)
-intermediates := $(call intermediates-dir-for,PACKAGING,recovery_patch)
-RECOVERY_FROM_BOOT_PATCH := $(intermediates)/recovery_from_boot.p
-$(RECOVERY_FROM_BOOT_PATCH): $(INSTALLED_RECOVERYIMAGE_TARGET) \
-                             $(INSTALLED_BOOTIMAGE_TARGET) \
-			     $(HOST_OUT_EXECUTABLES)/imgdiff \
-	                     $(HOST_OUT_EXECUTABLES)/bsdiff
-	@echo -e ${CL_CYN}"Construct recovery from boot"${CL_RST}
-	mkdir -p $(dir $@)
-	PATH=$(HOST_OUT_EXECUTABLES):$$PATH $(HOST_OUT_EXECUTABLES)/imgdiff $(INSTALLED_BOOTIMAGE_TARGET) $(INSTALLED_RECOVERYIMAGE_TARGET) $@
-endif
-
 
 $(INSTALLED_SYSTEMIMAGE): $(BUILT_SYSTEMIMAGE) $(RECOVERY_FROM_BOOT_PATCH) | $(ACP)
 	@echo -e ${CL_CYN}"Install system fs image: $@"${CL_RST}
diff --git a/tools/releasetools/common.py b/tools/releasetools/common.py
index ff7c26b..c9b634c 100644
--- a/tools/releasetools/common.py
+++ b/tools/releasetools/common.py
@@ -1156,6 +1156,8 @@ def MakeRecoveryPatch(input_dir, output_sink, recovery_img, boot_img,
   common.LoadInfoDict() on the input target_files.
   """
 
+  return
+
   if info_dict is None:
     info_dict = OPTIONS.info_dict
 
diff --git a/tools/releasetools/make_recovery_patch b/tools/releasetools/make_recovery_patch
index 08d1450..90fb6a4 100755
--- a/tools/releasetools/make_recovery_patch
+++ b/tools/releasetools/make_recovery_patch
@@ -49,5 +49,5 @@ def main(argv):
   common.MakeRecoveryPatch(input_dir, output_sink, recovery_img, boot_img)
 
 
-if __name__ == '__main__':
-  main(sys.argv[1:])
+#if __name__ == '__main__':
+#  main(sys.argv[1:])
-- 
1.9.1

