From a0943bd277ed9b5ecaf1c7c1ace7590b1b6da37d Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Mon, 20 Aug 2018 22:57:43 +0300
Subject: [PATCH] releasetools: ota_from_target_files: add FullOTA_InstallNew

diff --git a/tools/releasetools/common.py b/tools/releasetools/common.py
index 2cb9ae5..d49eb91 100644
--- a/tools/releasetools/common.py
+++ b/tools/releasetools/common.py
@@ -1223,6 +1223,11 @@ class DeviceSpecificParams(object):
     used to resize the system partition after a block based installation."""
     return self._DoCall("FullOTA_PostValidate")
 
+  def FullOTA_InstallNew(self):
+    """Called after installing and validating /ramdisk; typically this is
+    used to resize the ramdisk partition after a recovery installation."""
+    return self._DoCall("FullOTA_InstallNew")
+
   def IncrementalOTA_Assertions(self):
     """Called after emitting the block of assertions at the top of an
     incremental OTA package.  Implementations can add whatever
diff --git a/tools/releasetools/ota_from_target_files.py b/tools/releasetools/ota_from_target_files.py
index 8ec14f1..e6eff6a 100755
--- a/tools/releasetools/ota_from_target_files.py
+++ b/tools/releasetools/ota_from_target_files.py
@@ -536,6 +536,9 @@ else if get_stage("%(bcb_dev)s") == "3/3" then
 
   device_specific.FullOTA_PostValidate()
 
+  script.ShowProgress(0.2, 10)
+  device_specific.FullOTA_InstallNew()
+
   if OPTIONS.backuptool:
     script.ShowProgress(0.02, 10)
     script.Mount("/system")
