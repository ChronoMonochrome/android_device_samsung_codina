Subject: [PATCH] Add toggle to enable Android P system animation [1/2]

diff --git a/core/java/android/provider/Settings.java b/core/java/android/provider/Settings.java
index ef4b0847cb9..0181b740f69 100755
--- a/core/java/android/provider/Settings.java
+++ b/core/java/android/provider/Settings.java
@@ -10403,6 +10403,12 @@ public static final String getBluetoothSapPriorityKey(String address) {
                 "storage_settings_clobber_threshold";
 
         /**
+         * Default animation
+         * @hide
+         */
+        public static final String SYSTEM_DEFAULT_ANIMATION = "system_default_animation";
+
+        /**
          * Settings to backup. This is here so that it's in the same place as the settings
          * keys and easy to update.
          *
diff --git a/core/java/android/view/animation/AnimationUtils.java b/core/java/android/view/animation/AnimationUtils.java
index 01d98c1da98..4d46b1b9851 100644
--- a/core/java/android/view/animation/AnimationUtils.java
+++ b/core/java/android/view/animation/AnimationUtils.java
@@ -24,6 +24,8 @@
 import android.content.res.Resources.Theme;
 import android.content.res.XmlResourceParser;
 import android.os.SystemClock;
+import android.os.UserHandle;
+import android.provider.Settings;
 import android.util.AttributeSet;
 import android.util.Xml;
 import android.util.PathParser;
@@ -103,8 +105,13 @@ public static long currentAnimationTimeMillis() {
     public static Animation loadAnimation(Context context, @AnimRes int id)
             throws NotFoundException {
 
-        String name = context.getResources().getResourceEntryName(id);
-        switch(name) {
+        int defStyle = Settings.Global.getInt(context.getContentResolver(),
+                            Settings.Global.SYSTEM_DEFAULT_ANIMATION, 0);
+
+        if (defStyle == 0)
+            return loadAnimationFromXml(context, id);
+
+        switch (context.getResources().getResourceEntryName(id)) {
             case "activity_open_enter" : return getActivityOpenEnterAnim();
             case "activity_open_exit" : return getActivityOpenExitAnim();
             case "activity_close_enter" : return getActivityCloseEnterAnim();
@@ -113,7 +120,7 @@ public static Animation loadAnimation(Context context, @AnimRes int id)
             case "task_open_exit" : return getTaskOpenExitAnim();
             case "task_close_enter" : return getTaskCloseEnterAnim();
             case "task_close_exit" : return getTaskCloseExitAnim();
-            default: return loadAnimationFromXml(context,id);
+            default: return loadAnimationFromXml(context, id);
         }
     }
 
