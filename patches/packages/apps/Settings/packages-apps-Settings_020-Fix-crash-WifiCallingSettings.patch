From 8cbaa31b079cc4e5c0af3399b56b57972af886cc Mon Sep 17 00:00:00 2001
From: Libo Jin <liboj@codeaurora.org>
Date: Tue, 18 Jul 2017 15:10:19 +0800
Subject: [PATCH] Fix crash issue when user uses multi-window mode on WifiCallingSettings

There is possibility that an activity object is null in
PhoneStateListener#onCallStateChanged because it is called by
 different threads. If the activity object is null, NPE happens.
So, null check is necessary.

diff --git a/src/com/android/settings/WifiCallingSettings.java b/src/com/android/settings/WifiCallingSettings.java
index cb661ed9d5..0d90c251bd 100644
--- a/src/com/android/settings/WifiCallingSettings.java
+++ b/src/com/android/settings/WifiCallingSettings.java
@@ -87,6 +87,9 @@
         @Override
         public void onCallStateChanged(int state, String incomingNumber) {
             final SettingsActivity activity = (SettingsActivity) getActivity();
+            if (activity == null) {
+                return;
+            }
             boolean isNonTtyOrTtyOnVolteEnabled = ImsManager
                     .isNonTtyOrTtyOnVolteEnabled(activity);
             final SwitchBar switchBar = activity.getSwitchBar();
