From c872da810f7d1809151abf7403d41477c875c6d4 Mon Sep 17 00:00:00 2001
From: Alex Naidis <alex.naidis@linux.com>
Date: Tue, 28 Mar 2017 08:52:26 +0800
Subject: [PATCH 2/2] Dialer: InCallUI: Enable Sustained Performance Mode

We should make sure that thermals are stable during
active calls, so we should enable Sustained Performance
Mode for the InCallActivity.

As a side effect this will also save power during active calls.
---
 java/com/android/incallui/InCallActivityCommon.java | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/java/com/android/incallui/InCallActivityCommon.java b/java/com/android/incallui/InCallActivityCommon.java
index 3a264be..2c87f5c 100644
--- a/java/com/android/incallui/InCallActivityCommon.java
+++ b/java/com/android/incallui/InCallActivityCommon.java
@@ -21,6 +21,7 @@ import android.app.ActivityManager.AppTask;
 import android.app.ActivityManager.TaskDescription;
 import android.app.AlertDialog;
 import android.app.Dialog;
+import android.content.Context;
 import android.content.DialogInterface;
 import android.content.DialogInterface.OnCancelListener;
 import android.content.DialogInterface.OnDismissListener;
@@ -28,6 +29,7 @@ import android.content.Intent;
 import android.content.res.Configuration;
 import android.content.res.Resources;
 import android.os.Bundle;
+import android.os.PowerManager;
 import android.support.annotation.IntDef;
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
@@ -174,6 +176,12 @@ public class InCallActivityCommon {
 
     inCallActivity.getWindow().addFlags(flags);
 
+    // Enable Sustained Performance Mode if device power hal supports it
+    PowerManager pm = (PowerManager) inCallActivity.getSystemService(Context.POWER_SERVICE);
+    if (pm.isSustainedPerformanceModeSupported()) {
+        inCallActivity.getWindow().setSustainedPerformanceMode(true);
+    }
+
     inCallActivity.setContentView(R.layout.incall_screen);
 
     internalResolveIntent(inCallActivity.getIntent());
-- 
2.11.0

