From 325f87a6af21413c97c6a62ac12179b22fc3e8b1 Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Tue, 16 May 2017 23:05:02 +0300
Subject: [PATCH] build ffmpeg targets

Change-Id: Ia4ff9b3547c6c13f7a69bd6f19024ee775bf3da4
---
 config/common.mk | 39 +++++++++++++--------------------------
 1 file changed, 13 insertions(+), 26 deletions(-)

diff --git a/config/common.mk b/config/common.mk
index 5f0e32e..f36f9f9 100644
--- a/config/common.mk
+++ b/config/common.mk
@@ -24,10 +24,20 @@ PRODUCT_PROPERTY_OVERRIDES += \
     ro.setupwizard.enterprise_mode=1 \
     persist.sys.root_access=1
 
+# Stagefright FFMPEG plugin
+PRODUCT_PACKAGES += \
+    libffmpeg_extractor \
+    libffmpeg_omx \
+    media_codecs_ffmpeg.xml
+
+PRODUCT_PROPERTY_OVERRIDES += \
+    media.sf.omx-plugin=libffmpeg_omx.so \
+    media.sf.extractor-plugin=libffmpeg_extractor.so
+
 # enable ADB authentication if not on eng build
-ifneq ($(TARGET_BUILD_VARIANT),eng)
-ADDITIONAL_DEFAULT_PROPERTIES += ro.adb.secure=1
-endif
+#ifneq ($(TARGET_BUILD_VARIANT),eng)
+#ADDITIONAL_DEFAULT_PROPERTIES += ro.adb.secure=1
+#endif
 
 # Backup Tool
 PRODUCT_COPY_FILES += \
@@ -85,26 +95,3 @@ PRODUCT_COPY_FILES += \
 
 # Add our overlays
 PRODUCT_PACKAGE_OVERLAYS += vendor/omni/overlay/common
-
-# Enable dexpreopt for all nightlies
-ifeq ($(ROM_BUILDTYPE),NIGHTLY)
-    ifeq ($(WITH_DEXPREOPT),)
-        WITH_DEXPREOPT := true
-    endif
-endif
-# and weeklies
-ifeq ($(ROM_BUILDTYPE),WEEKLY)
-    ifeq ($(WITH_DEXPREOPT),)
-        WITH_DEXPREOPT := true
-    endif
-endif
-# and security releases
-ifeq ($(ROM_BUILDTYPE),SECURITY_RELEASE)
-    ifeq ($(WITH_DEXPREOPT),)
-        WITH_DEXPREOPT := true
-    endif
-endif
-# but not homemades
-ifeq ($(ROM_BUILDTYPE),HOMEMADE)
-    WITH_DEXPREOPT := false
-endif
-- 
2.5.0

