From cdc8e6b396b6bc33197aebd1d144bd2674d7bf97 Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Sat, 12 Mar 2016 12:18:12 +0700
Subject: [PATCH 3/3] Revert "Remove text-relocs support for apps targeting M+"

This reverts commit e4ad91f86a47b39612e030a162f4793cb3421d31.

Change-Id: I2f022f9577747513c05efc5e44531cb5479d0eea
---
 linker/linker.cpp | 9 ---------
 1 file changed, 9 deletions(-)

diff --git a/linker/linker.cpp b/linker/linker.cpp
index 7ca4710..5edf2cb 100644
--- a/linker/linker.cpp
+++ b/linker/linker.cpp
@@ -4059,17 +4059,8 @@ bool soinfo::link_image(const soinfo_list_t& global_group, const soinfo_list_t&
 
 #if !defined(__LP64__)
   if (has_text_relocations) {
-    // Fail if app is targeting sdk version > 22
-    if (get_application_target_sdk_version() > 22) {
-      PRINT("%s: has text relocations", get_realpath());
-      DL_ERR("%s: has text relocations", get_realpath());
-      return false;
-    }
     // Make segments writable to allow text relocations to work properly. We will later call
     // phdr_table_protect_segments() after all of them are applied.
-    DL_WARN("%s has text relocations. This is wasting memory and prevents "
-            "security hardening. Please fix.", get_realpath());
-    add_dlwarning(get_realpath(), "text relocations");
     if (phdr_table_unprotect_segments(phdr, phnum, load_bias) < 0) {
       DL_ERR("can't unprotect loadable segments for \"%s\": %s",
              get_realpath(), strerror(errno));
-- 
2.5.0

